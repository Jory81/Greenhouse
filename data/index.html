<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="style.css"> 
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
</head>
<body>
<br>
<div class='time-frame'>
	<div>
    <span id='date-part'></span>
    <span> &nbsp  / &nbsp  </span>
    <span id='time-part'></span>
	
	<span id="checkbox4">
	<input class="ckeckbox-element" type="checkbox" id="1I1" onclick="updateButton('1I1')"/>  
	<i class="glyphicon glyphicon-volume-off"></i>
	</span>  
	
	</div>
	
	<div>	
	<span class="dht-labels">system settings</span>
	<span class="tab">
	<span id="checkbox3">
	<input class="ckeckbox-element" type="checkbox" id="1Z3" onclick="openTab('1Z3', event, 'Systemsettings')"/>  
	&nbsp;
	<i class="glyphicon glyphicon-pencil"></i>
	</span>
	
	<span class="dht-labels">calibration settings</span>
	<span class="tab">
	<span id="checkbox3">
	<input class="ckeckbox-element" type="checkbox" id="1Z4" onclick="openTab('1Z4', event, 'Calsettings')"/>  
	&nbsp;
	<i class="glyphicon glyphicon-pencil"></i>
	</span>
	</div>
</div>
<hr>
<div id="tempcontrol" class="tabcontent">
  <span onclick="toggleoff(this.parentElement)" class="topright">&times</span>

    <h4>Ground probe</h4>
	<div class="inputcontainer">
		<span class="inputparam"> <input type="number" placeholder="input Temp 1" class="form-controlx input-sl" id="A1" value=""></span> <span><button onclick="updateTemp('1A1')" class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
		<span class="dht-labels"></span> 
		<span id="targetTemperature1"></span>
		<sup class="units">&deg;C</sup>
		
	</div>	

	<div class="inputcontainer">
		<span class="inputparam"> <input type="number" placeholder="temp range" class="form-controlx input-sl" id="K2" value=""></span> <span><button onclick="updateTemp('1K2')" class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
		<span class="dht-labels"></span> 
		<span id="offsetFromTargetTempMin"></span>
		<sup class="units">&deg;C</sup>
		
	</div>
	
	<div class="inputcontainer">
		<span class="inputparam"> <input type="number" placeholder="alarm range" class="form-controlx input-sl" id="K1" value=""></span> <span><button onclick="updateTemp('1K1')" class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;    
		<span class="dht-labels"></span> 
        <span id="offsetFromTargetTempMax"></span>
        <sup class="units">&deg;C</sup>
		
		<span id="checkbox1">
		<input class="ckeckbox-element" type="checkbox" id="1M1" onclick="updateButton('1M1')"/>  
		<i class="glyphicon glyphicon-bell"></i>
		</span>
	
	</div>	
	
	
	<hr>
</div>

<div id="tempcontrol2" class="tabcontent">
  <span onclick="toggleoff(this.parentElement)" class="topright">&times</span>
<h4>Air probe</h4>
	
	<div class="inputcontainer">
		<span class="inputparam"> <input type="number" placeholder="input Temp 2" class="form-controlx input-sl" id="A2" value=""></span> <span><button onclick="updateTemp('1A2')" class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
		<span class="dht-labels"></span> 
		<span id="targetTemperature2"></span>
		<sup class="units">&deg;C</sup>
		
		<span id="checkbox1">
		<input class="ckeckbox-element" type="checkbox" id="1J2" onclick="updateButton('1J2')"/>  
		<i class="glyphicon glyphicon-bell"></i>
		</span> 
		
	</div>
	
	<hr>
</div>

<div id="humidcontrol" class="tabcontent">
  <span onclick="toggleoff(this.parentElement)" class="topright">&times</span>

	<h4>Lights:</h4>
	
	<p>
	Lights on: <input class="timeMakeup" type="time" id="lightsON">
	Lights off: <input class="timeMakeup" type="time" id="lightsOFF">
	<br>
	<br>
	<button onclick="updateTemp('L')" class="btnx btn-primary">_submit light schedule</button> </span>
	<br>
	<br>
	<br>
	</p>

<h4>humid probes</h4>
	
	<div class="inputcontainer">
		<span class="inputparam"> <input type="number" placeholder="input humidity min." class="form-controlx input-sl" id="C1" value=""></span> <span><button onclick="updateTemp('1C1')" class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
		<span class="dht-labels"></span> 
		<span id="targetHumidMin"></span>
		<sup class="units">%</sup>
		
		<span id="checkbox1">
		<input class="ckeckbox-element" type="checkbox" id="1G1" onclick="updateButton('1G1')"/>  
		<i class="glyphicon glyphicon-bell"></i>
		</span> 
		
	</div>
	
	<div class="inputcontainer">
		<span class="inputparam"> <input type="number" placeholder="input humidity max." class="form-controlx input-sl" id="C2" value=""></span> <span><button onclick="updateTemp('1C2')" class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
		<span class="dht-labels"></span> 
		<span id="targetHumidMax"></span>
		<span class="units">%</span>
		
		<span id="checkbox1">
		<input class="ckeckbox-element" type="checkbox" id="1G2" onclick="updateButton('1G2')"/>  
		<i class="glyphicon glyphicon-bell"></i>
		</span> 
	</div>
	<hr>
</div>


<div id="Calsettings" class="tabcontent">
<h4>calibration settings:</h4>
  <span onclick="toggleoff(this.parentElement)" class="topright">&times</span>
		<div class="inputcontainer">
			<span class="inputparam"> <input type="number" placeholder="input cal. 1" class="form-controlx input-sl" id="cv1" value=""></span> <span><button onclick="updateText('cv1')" class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
			<i class="glyphicon glyphicon-signal"></i>
			<span class="dht-labels"></span> 
			<span id="cal_val1"></span>
			<sup class="units">&deg;C</sup>
		</div>
		<div class="inputcontainer">
			<span class="inputparam"> <input type="number" placeholder="input cal. 2" class="form-controlx input-sl" id="cv2" value=""></span> <span><button onclick="updateText('cv2')" class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
			<i class="glyphicon glyphicon-signal"></i> 
			<span class="dht-labels"></span> 
			<span id="cal_val2"></span>
			<sup class="units">&deg;C</sup>
		</div>
		<div class="inputcontainer">
			<span class="inputparam"> <input type="number" placeholder="input cal. 3" class="form-controlx input-sl" id="cv3" value=""></span> <span><button onclick="updateText('cv3')" class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
			<i class="glyphicon glyphicon-signal"></i>
			<span class="dht-labels"></span> 
			<span id="cal_val3"></span>
			<sup class="units">&deg;C</sup>
		</div>
		<div class="inputcontainer">
			<span class="inputparam"> <input type="number" placeholder="input cal. 4" class="form-controlx input-sl" id="cv4" value=""></span> <span><button onclick="updateText('cv4')"  class="btnx btn-primary">_submit</button> </span>      	&nbsp; &nbsp;
			<i class="glyphicon glyphicon-signal"></i>
			<span class="dht-labels"></span> 
			<span id="cal_val4"></span>
			<sup class="units">&deg;C</sup>
		</div>
		<div class="inputcontainer">
			<span class="inputparam"> <input type="number" placeholder="input cal. 5" class="form-controlx input-sl" id="cv5" value=""></span> <span><button onclick="updateText('cv5')"  class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
			<i class="glyphicon glyphicon-signal"></i> 
			<span class="dht-labels"></span> 
			<span id="cal_val5"></span>
			<sup class="units">&deg;C</sup>	
		</div>	
        <br>		
		<div class="inputcontainer">
			<span class="inputparam"> <input type="number" placeholder="input KP or MIN" class="form-controlx input-sl" id="pv1" value=""></span> <span><button onclick="updateText('pv1')"  class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
			<i class="glyphicon glyphicon-signal"></i> 
			<span class="dht-labels"></span>
			<span id="pid_val1"></span>
		</div>			
		<div class="inputcontainer">
			<span class="inputparam"> <input type="number" placeholder="input KI or MAX" class="form-controlx input-sl" id="pv2" value=""></span> <span><button onclick="updateText('pv2')"  class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
			<i class="glyphicon glyphicon-signal"></i> 
			<span class="dht-labels"></span> 
			<span id="pid_val2"></span>
		</div>			
		<div class="inputcontainer">
			<span class="inputparam"> <input type="number" placeholder="input KD (-)" class="form-controlx input-sl" id="pv3" value=""></span> <span><button onclick="updateText('pv3')"  class="btnx btn-primary">_submit</button> </span>			&nbsp; &nbsp;
			<i class="glyphicon glyphicon-signal"></i> 
			<span class="dht-labels"></span> 
			<span id="pid_val3"></span>
		</div>
		<hr>
</div>

<div id="Systemsettings" class="tabcontent">
  <span onclick="toggleoff(this.parentElement)" class="topright">&times</span>
	<h4>system settings:</h4>	
	<p>	
	<span class="inputparam">
	<select name="selectProbeType" id="probe_id" onchange="selectProbeTType(this)">
    <option value="1" >PT100</option>
    <option value="2" >Thermokoppel</option>
	</select>
	</span>
	<br>
	<br>
	<span class="inputparam">
	<select name="selectProbeAmount" id="probe_number" onchange="selectProbeTAmount(this)">
    <option value="1" >1 probe</option>
    <option value="2" >2 probes</option>
	<option value="3" >3 probes</option>
	<option value="4" >4 probes</option>
	<option value="5" >5 probes</option>
	</select>	
	</span>
	<br>
	<br>
	<span class="inputparam">
	<select name="selectProbeType" id="probe_id" onchange="selectProbeHType(this)">
    <option value="0" >DHT22</option>
	</select>
	</span>
	<br>
	<br>
	<span class="inputparam">
	<select name="selectProbeAmount" id="probe_numberH" onchange="selectProbeHAmount(this)">
    <option value="0" >no probes</option>
	<option value="1" >1 probe</option>
    <option value="2" >2 probes</option>
	<option value="3" >3 probes</option>
	</select>	
	</span>
	<br>
	<br>
	</p>	
	<h4>graph update:</h4>
	<p>
	<span class="inputparam">
	<select name="selectProbeAmount" id="graph_time" onchange="selectUpdateGraphTime(this)">
    <option value="1" >every second</option>
    <option value="2" >every 2 seconds</option>
	<option value="5" >every 5 seconds</option>
	<option value="30" >every 30 seconds</option>
	<option value="60" >every minute</option>
	<option value="120" >every 2 minutes</option>
	<option value="300" >every 5 minutes</option>
	</select>	
	</span>
	<br>
	<br>
	</p>

	<div>
		<span id="checkbox1">PID control (checked) or linear control
		<input class="ckeckbox-element" type="checkbox" id="1X1" onclick="updateButton('1X1')"/>  
		<i class="glyphicon glyphicon-tasks"></i>
		</span> 
	</div>		

	<br>
	

	<div class="inputcontainer">
		<span class="inputparam"> <input type="text" placeholder="input Wifi ID" class="form-controlx input-sl" id="ssid" value=""></span> <span><button onclick="updateTemp('I')" class="btnx btn-primary">_submit</button> </span>	<span id="SSID"></span>
	</div>
	<div class="inputcontainer">
		<span class="inputparam"> <input type="text" placeholder="input Wifi pass" class="form-controlx input-sl" id="pass" value=""></span> <span><button onclick="updateTemp('P')" class="btnx btn-primary">_submit</button> </span>	<span id="PASS"></span>
	</div>

	<div>
	<span id="checkbox1">reboot &nbsp
	<input class="ckeckbox-element" type="checkbox" id="1U1" onclick="updateButton('1U1')"/>  
	<i class="glyphicon glyphicon-refresh"></i>
	</span> 
	</div>	
	<hr>
</div>

	<div class="inline">

		<h4>temperature</h4>
		<p>
		<i class="fas fa-thermometer-half" style="color:#62BD69;"></i> 
		<span class="dht-labels">Ground</span> 
		<span id="temperature1"></span>
		<sup class="units">&deg;C</sup>
		
		<span id="checkbox4">
		<input class="ckeckbox-element" type="checkbox" id="1L4" />  
		&nbsp;
		<i class="glyphicon glyphicon-fire"></i>
		</span> 
		
		<span class="tab">
		<span id="checkbox3">
		<input class="ckeckbox-element" id="1Z1" type="checkbox" onclick="openTab('1Z1', event, 'tempcontrol')"/>  
		<i class="glyphicon glyphicon-pencil"></i>
		</span> 
		
		</p>	
		
		<p>
			<i class="fas fa-thermometer-half" style="color:#a6e7ff;"></i> 
			<span class="dht-labels">Air</span> 
			<span id="temperature2"></span>
			<sup class="units">&deg;C</sup>
			
			<span class="tab">
			<span id="checkbox3">
			<input class="ckeckbox-element" id="1Z2" type="checkbox" onclick="openTab('1Z2', event, 'tempcontrol2')"/>  
			<i class="glyphicon glyphicon-pencil"></i>
			</span> 
			
		</p>
		
		<span class="dht-labels">more probes:</span>
		<span id="checkbox1">
		<input class="ckeckbox-element" type="checkbox" id="1N1" onclick="setTab('SetTab2')"/>  
		<i class="glyphicon glyphicon-menu-down"></i>
		</span> 

		<div id="SetTab2">
		<p>	
		<span>
			<span class="dht-labels">t3</span> 
			<span id="temperature3"></span>
			<sup class="units">&deg;C</sup>

			<span class="dht-labels">t4</span> 
			<span id="temperature4"></span>
			<sup class="units">&deg;C</sup>

			<span class="dht-labels">t5</span> 
			<span id="temperature5"></span>
			<sup class="units">&deg;C</sup>
		</span>
		</p>
		</div>

	</div>
	<div class="inline">
		<h4>fan</h4>

			<span id="checkbox2">
			<input class="ckeckbox-element" type="checkbox" id="1L1" onclick="updateButton('1L1')"/>  
			&nbsp;
			<i class="glyphicon glyphicon-refresh"></i>
			</span> 
		
			<span>
				<span class="dht-labels">Speed</span> 		
				<span id="fanSpeed"></span>
				<span class="dht-labels">%</span> 	
			</span>

			
			<div>
			<span class="textinfo">manual control</span>
			<input type="checkbox" id="1T1" onclick="updateButton('1T1')"> 
			</div>
		
			<div>
			<label class="slidercontainerx">	
			<input id="1Y1" type="range" class="slider" min="0" max="255" step="1" value="128" onchange="updateSlider('1Y1', this.value)">
			</label>
			</div>

	</div>
	
	<div class="inline">
	
	<h4>humidity / light
	
	&nbsp
	<span class="tab">
	<span id="checkbox3">
	<input class="ckeckbox-element" id="1Z5" type="checkbox" onclick="openTab('1Z5', event, 'humidcontrol')"/>  
	<i class="glyphicon glyphicon-pencil"></i>
	</span> 
	
	</h4>
	
	<span id="checkbox5">
	<input class="ckeckbox-element" type="checkbox" id="1L2"/>  
	&nbsp;
	<i class="glyphicon glyphicon-asterisk"></i>
	</span> 
	
	&nbsp;
	<span id="checkbox1">
	<input class="ckeckbox-element" type="checkbox" id="1L3"/>  
	&nbsp;
	<i class="glyphicon glyphicon-leaf"></i>
	</span> 	
	
	<div>
	<span class="dht-labels">RH 1: </span> 
	<span id="humid1"></span>
	<span class="units">(%)</span>	
	</div>
	
	<div>
	<span class="dht-labels">RH 2: </span> 
	<span id="humid2"></span>
	<span class="units">(%)</span>	
	</div>

	<div>
	<span class="dht-labels">RH 3: </span> 
	<span id="humid3"></span>
	<span class="units">(%)</span>	
	</div>		

	</div>

    <div id="chart-temperature" class="container">
	</div>
	
	<hr>
  
<script>
/*
function myFunction() {
document.getElementById("demo").innerHTML = "choose"
if (document.getElementById("GGG").checked == true) {  
document.getElementById("demo").innerHTML = "hello";
}
else if (document.getElementById("GGG").checked == false){
document.getElementById("demo").innerHTML = "hi";   
}  
} 
*/ 
</script> 

<script>	

var gateway = `ws://${window.location.hostname}/ws`;
var websocket;

console.log(gateway);

var k = 10;
var residuFloat = 0; 

var humidmin = 30;
var humidmax = 80;

var hourStart = 05;
var minuteStart = 30;
var hourStop = 20;
var minuteStop = 30;

var targetCelsius1=0;
var targetCelsius2=0;
var offsetFromTargetTempMax=0;
var offsetFromTargetTempMin=0;
//var tempOffsetAlarm=false;

var fanSpeed=0;
var humidity=0;
//var alarmActiveTimer1=false;
//var alarmActiveTimer2=false;

//var alarmActiveTemp1=false;

var timer1Counter=0;
var timer2Counter=0;
var numberofRingsAlarm1=0;
var numberofRingsAlarm2=0;
var refreshIntervalId1=0;
var refreshIntervalId2=0;
//var alarmReachTemp1=false;
//var alarmReachTemp2=false;

// ----------------------------------------------------------------------------
// Initialization
// ----------------------------------------------------------------------------

window.addEventListener('load', onLoad);

function onLoad(event) {
	
    initWebSocket();
//    initButton();
}

// ----------------------------------------------------------------------------
// WebSocket handling
// ----------------------------------------------------------------------------

function initWebSocket() {
    console.log('Trying to open a WebSocket connection...');
    websocket = new WebSocket(gateway);
    websocket.onopen    = onOpen;
    websocket.onclose   = onClose;
    websocket.onmessage = onMessage;
}
 
// Called when a WebSocket connection is established with the server

function onOpen(event) {
 
    // Log connection state
    console.log("Connected");
	document.getElementById("SetTab2").style.display = "none";	
	document.getElementById("1U1").checked = true;
	k = 0;
	doSend("GGG"+k);

}
 
// Called when the WebSocket connection is closed
function onClose(event) {
    console.log('Connection closed');
    setTimeout(initWebSocket, 2000);
}

 
// Called when a message is received from the server
function onMessage(event) {
 
    // Print out our received message
    // console.log("Received: " + event.data);

	var string = event.data;
	
//  console.log(k);
if (string.charAt(0) == 'G'){
	
	if (string.charAt(1) == 'C'){// receive targetCelsius1 parameter
		var residu = string.slice(2, string.length);
		document.getElementById("targetTemperature1").innerHTML = residu;		
		targetCelsius1 = parseInt(residu);
	}	
	else if (string.charAt(1) == 'D'){
		var residu = string.slice(2, string.length);	
		document.getElementById("targetTemperature2").innerHTML = residu;
		targetCelsius2 = parseInt(residu);
	}	

	else if (string.charAt(1) == 'H'){
		var residu = string.slice(2, string.length);	
		document.getElementById("targetHumidMax").innerHTML = residu;
		humidmax = parseInt(residu);
	}

	else if (string.charAt(1) == 'h'){
		var residu = string.slice(2, string.length);	
		document.getElementById("targetHumidMin").innerHTML = residu;
		humidmin = parseInt(residu);
	}	
	
	else if (string.charAt(1) == 'l'){// failsafe to preven ongoing alarm1 firing when conditions are met
		var residu = string.slice(2, string.length);	
		//console.log(residu);
		hourStart = residu.slice(0, 2);	
		minuteStart = residu.slice(2, 4);
		hourStop = residu.slice(4, 6);
		minuteStop = residu.slice(6, 8);

		document.getElementById("lightsON").value = hourStart +':' + minuteStart;
		document.getElementById("lightsOFF").value = hourStop +':' + minuteStop;
	}
	
    else if (string.charAt(1) == 'N'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		if (residu == '0'){
		document.getElementById("1J2").checked = false;
		//alarmReachTemp2 = false;
		}
		else if (residu == '1'){
		document.getElementById("1J2").checked = true;
		//alarmReachTemp2 = true;
		}
	}	
	
    else if (string.charAt(1) == 'G'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		if (residu == '0'){
		document.getElementById("1G1").checked = false;
		//alarmReachTemp2 = false;
		}
		else if (residu == '1'){
		document.getElementById("1G1").checked = true;
		//alarmReachTemp2 = true;
		}
	}

    else if (string.charAt(1) == 'r'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		if (residu == '0'){
		document.getElementById("1G2").checked = false;
		//alarmReachTemp2 = false;
		}
		else if (residu == '1'){
		document.getElementById("1G2").checked = true;
		//alarmReachTemp2 = true;
		}
	}	
	
	else if (string.charAt(1) == 'O'){// receive alarmTime1 parameter
		var residu = string.slice(2, string.length);
		document.getElementById("offsetFromTargetTempMax").innerHTML = residu;
		offsetFromTargetTempMax = parseInt(residu);
	}
	
	else if (string.charAt(1) == 'o'){// receive alarmTime1 parameter
		var residu = string.slice(2, string.length);
		document.getElementById("offsetFromTargetTempMin").innerHTML = residu;
		offsetFromTargetTempMin = parseInt(residu);
	}
	
    else if (string.charAt(1) == 'Q'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		if (residu == '0'){
		document.getElementById("1L1").checked = false;
		}
		else if (residu == '1'){
		document.getElementById("1L1").checked = true;
		}
	}
	
	else if (string.charAt(1) == 'q'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		if (residu == '0'){
		document.getElementById("1L2").checked = false;
		}
		else if (residu == '1'){
		document.getElementById("1L2").checked = true;
		}
	}	
	
	else if (string.charAt(1) == 'g'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		if (residu == '0'){
		document.getElementById("1L3").checked = false;
		}
		else if (residu == '1'){
		document.getElementById("1L3").checked = true;
		}
	}

	else if (string.charAt(1) == 's'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		if (residu == '0'){
		document.getElementById("1L4").checked = false;
		}
		else if (residu == '1'){
		document.getElementById("1L4").checked = true;
		}
	}	
	
    else if (string.charAt(1) == 'R'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		if (residu == '0'){
		document.getElementById("1M1").checked = false;
		}
		else if (residu == '1'){
		document.getElementById("1M1").checked = true;
		}
	}	
	
    else if (string.charAt(1) == 'S'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		document.getElementById("probe_number").value = residu;
	}
    else if (string.charAt(1) == 'E'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		document.getElementById("probe_numberH").value = residu;
	}	
	
	else if (string.charAt(1) == 'e'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		document.getElementById("graph_time").value = residu;
	}	
	
    else if (string.charAt(1) == 'T'){// sets alarm1 when targetCelsius 1 is reached.
		var residu = string.slice(2, string.length);	
		document.getElementById("probe_id").value = residu;
	}	
	
	else if (string.charAt(1) == 'U'){// checkBox - activates alarm1 Timer checkbox (alarmTime1)
		var residu = string.slice(2, string.length);	
		if (residu == '0'){
		document.getElementById("1T1").checked = false;
		//alarmActiveTimer2 = false;
		}
		else if (residu == '1'){
		document.getElementById("1T1").checked = true;
		//alarmActiveTimer2 = true;
		}
	}

	else if (string.charAt(1) == 'X'){
		var residu = string.slice(2, string.length);	
		if (residu == '0'){
		document.getElementById("1X1").checked = false;
		//alarmActiveTimer2 = false;
		}
		else if (residu == '1'){
		document.getElementById("1X1").checked = true;
		//alarmActiveTimer2 = true;
		}
	}	
	
	else if (string.charAt(1) == 'V'){// checkBox - activates alarm1 Timer checkbox (alarmTime1)
		var numArgs = 0;
		var pos1 = 1;
		var pos2 = 0;
		var cal_values = new Array(5)
		var altString = string.slice(1, string.length);
		//console.log(altString);
		for( var t = 0; t < altString.length; t++ ){
			if (altString[t] == '+'){
				pos2 = t;
				var cal = altString.substring(pos1, pos2);
				cal_values[numArgs] = cal;		
				numArgs = numArgs+1;
				pos1 = t+1;		
			}
		}	
		document.getElementById("cal_val1").innerHTML = cal_values[0];
		document.getElementById("cal_val2").innerHTML = cal_values[1];
		document.getElementById("cal_val3").innerHTML = cal_values[2];
		document.getElementById("cal_val4").innerHTML = cal_values[3];
		document.getElementById("cal_val5").innerHTML = cal_values[4];
	}

	else if (string.charAt(1) == 'W'){// checkBox - activates alarm1 Timer checkbox (alarmTime1)
		var numArgs = 0;
		var pos1 = 1;
		var pos2 = 0;
		var pid_cal_values = new Array(3)
		var altString = string.slice(1, string.length);
		//console.log(altString);
		for( var t = 0; t < altString.length; t++ ){
			if (altString[t] == '+'){
				pos2 = t;
				var cal = altString.substring(pos1, pos2);
				pid_cal_values[numArgs] = cal;		
				numArgs = numArgs+1;
				pos1 = t+1;		
			}
		}	
		document.getElementById("pid_val1").innerHTML = pid_cal_values[0];
		document.getElementById("pid_val2").innerHTML = pid_cal_values[1];
		document.getElementById("pid_val3").innerHTML = pid_cal_values[2];
	}
	
	else if (string.charAt(1) == 'Y'){// receive alarmTime1 parameter
		var residu = string.slice(2, string.length);
		document.getElementById("1Y1").innerHTML = residu;

	}
	
	else {
	};
	
	if (k < 24){
	//console.log("k "); console.log(k);
    doSend("GGG"+k);
	k = k + 1;
    }
}
else if (string.charAt(0) == 'H'){
	var numArgs = 0;
	var pos1 = 1;
	var pos2 = 0;
	var humid_values = new Array(3)
	var fullString = string.slice(1, string.length);
	for( var t = 0; t < string.length; t++ ){
		if (string[t] == '+'){
			pos2 = t;
			var temp = string.substring(pos1, pos2);
			humid_values[numArgs] = temp;		
			numArgs = numArgs+1;
			pos1 = t+1;		
		}
	}
	
	for (var x = 0; x < numArgs; x ++){
	residu = humid_values[x]
		if (x == 0){
		document.getElementById("humid1").innerHTML = residu;	
		
			if ((residu < humidmin-10 && document.getElementById("1G1").checked == true) || (residu > humidmax+10 && document.getElementById("1G1").checked == true)){ //;tempOffsetAlarm == true){  // alarmActiveTemp1
			//tempOffsetAlarm = false; // alarmActiveTemp1
			document.getElementById("1G1").checked = false;
			document.getElementById("1G2").checked = false;
			document.getElementById("1I1").checked = true;
			doSend("1G1"+0);
			doSend("1G2"+0);
			doSend('1RR'+2);
			//playSound1(100);	
			}
		
		}
		else if (x == 1){
		document.getElementById("humid2").innerHTML = residu;	
		}
		else if (x == 2){
		document.getElementById("humid3").innerHTML = residu;
		}		
	}	
}
else if (string.charAt(0) == 'T'){
	var numArgs = 0;
	var pos1 = 1;
	var pos2 = 0;
	var temp_values = new Array(5)
	var fullString = string.slice(1, string.length);
	for( var t = 0; t < string.length; t++ ){
		if (string[t] == '+'){
			pos2 = t;
			var temp = string.substring(pos1, pos2);
			temp_values[numArgs] = temp;		
			numArgs = numArgs+1;
			pos1 = t+1;		
		}
	}
	
	for (var x = 0; x < numArgs; x ++){
	residu = temp_values[x]
		if (x == 0){
		document.getElementById("temperature1").innerHTML = residu;
			if (targetCelsius1 > 0){
				if (offsetFromTargetTempMax > 1){
					if ((residu > targetCelsius1 + offsetFromTargetTempMax || residu < targetCelsius1 - offsetFromTargetTempMax) && document.getElementById("1M1").checked == true){ //;tempOffsetAlarm == true){  // alarmActiveTemp1
					//tempOffsetAlarm = false; // alarmActiveTemp1
					document.getElementById("1M1").checked = false;
					document.getElementById("1I1").checked = true;
					doSend("1M1"+0);
					doSend('1RR'+2);
					//playSound1(100);	
					}
				}
			}	
		}
		else if (x == 1){
		document.getElementById("temperature2").innerHTML = residu;
			if (targetCelsius2 > 0){
				if (residu >= targetCelsius2 && document.getElementById("1J2").checked == true){ // alarmReachTemp2 == true
				//alarmReachTemp2 = false;	
				document.getElementById("1J2").checked = false;	
				document.getElementById("1I1").checked = true;					
				doSend("1J2"+0);
				doSend('1RR'+1);
				//playSound1(100);				
				}
			}	
		}
		else if (x == 2){
			document.getElementById("temperature3").innerHTML = residu;
		}	
		else if (x == 3){
			document.getElementById("temperature4").innerHTML = residu;
		}
		else if (x == 4){
			document.getElementById("temperature5").innerHTML = residu;
		}	
	}
	updateTime();	
}
else if (string.charAt(0) == 'S'){	
	if (string.charAt(1) == 'C'){
		var residu = string.slice(2, string.length);	
		var residuFloat = parseFloat(residu).toFixed(2);
		drawChart(residuFloat);
	}
	else if (string.charAt(1) == 'D'){
		var residu = string.slice(2, string.length);	
		var residuFloat = parseFloat(residu).toFixed(2);
		drawChart1(residuFloat);
	}	

    else if (string.charAt(1) == 'I'){
		var residu = string.slice(2, string.length);
		document.getElementById("fanSpeed").innerHTML = residu;	
		fanSpeed = residu;	
		//console.log(fanSpeed);
	}
}
else if (string.charAt(0) == 'R'){
	if (string.charAt(1) == 'P'){
		var residu = string.slice(2, string.length);
		//console.log('redidu pass'); console.log(residu);
		document.getElementById("PASS").innerHTML = residu;	
	}
	else if (string.charAt(1) == 'I'){
		var residu = string.slice(2, string.length);
		//console.log('redidu ssid'); console.log(residu);
		document.getElementById("SSID").innerHTML = residu;	
	}	
}	
}	
 
// Sends a message to the server (and prints it to the console)
function doSend(message) {
	String(message);
    //console.log("Sending: " + message);
    websocket.send(message);
}
	
	
</script>	

<script src="https://code.highcharts.com/highcharts.js"></script>

<script>
 	var chartT = new Highcharts.Chart({
            chart: { renderTo : 'chart-temperature',
					backgroundColor: '#808080',
			},
            title: { text: 'Temperature History',
						style: {color: '#ffffff',}
					},
            series: [
                {
                    showInLegend: true,
                    name: 'Ground temp',
                    data: [],
                    color: '#ff0000'
                }, 
                {
                    showInLegend: true,
                    name: 'target Temp',
                    data: [], 
                    color: '#0000ff'
                },
				{
                    showInLegend: true,
                    name: 'Air temp',
                    data: [],
                    color: '#ffff00'
                },
				{
                    showInLegend: true,
                    name: 'fanSpeed %',
                    data: [], 
                    color: '#00ff00'
                },
				{
                    showInLegend: true,
                    name: 'humidity %',
                    data: [], 
                    color: '#00ffff'
                }

            ],
			tooltip: {
				valueSuffix: '\xB0 C'
			},
			 plotOptions: {
				line: {
					lineWidth: 2,
					states: {
						hover: {
							lineWidth: 3
						}
					},
					
					marker: {
						enabled: false
					}
					
				}
			},
			legend: {
				itemStyle: {
					color: 'white'
				}  
			},
            xAxis: { 
               type: 'datetime',
               dateTimeLabelFormats: { second: '%H:%M:%S' },
			   title: { style: {color:"#ffffff"}},
			   labels: { style: {color:"#ffffff"}}
            },
            yAxis: {
                title: { text: 'Temperature (Celsius)',
						 style: {color:"#ffffff"}},
				labels: { style: {color:"#ffffff"}}
            },
            credits: { enabled: false }
        });
function drawChart(temp){
            var x = (new Date()).getTime();
			var currentCelsius = parseFloat(temp);
			var currentFanSpeed = parseFloat(fanSpeed);
			var currentHumidity = parseFloat(humidity);
			if(chartT.series[0].data.length > 1440) {
				chartT.series[0].addPoint([x, currentCelsius], true, true, true);
				chartT.series[3].addPoint([x, currentFanSpeed], true, true, true);
				chartT.series[4].addPoint([x, currentHumidity], true, true, true);
			} else {
				chartT.series[0].addPoint([x, currentCelsius], true, false, true);
				chartT.series[3].addPoint([x, currentFanSpeed], true, false, true);
				chartT.series[4].addPoint([x, currentHumidity], true, false, true);
			}
            if (targetCelsius1 > 0) {
                if(chartT.series[1].data.length > 1440) {
                    chartT.series[1].addPoint([x, targetCelsius1], true, true, true);
                } else {
                    chartT.series[1].addPoint([x, targetCelsius1], true, false, true);
                }
            }
};
function drawChart1(temp){
            var x = (new Date()).getTime();
			var currentCelsius = parseFloat(temp);
			if(chartT.series[2].data.length > 1440) {
				chartT.series[2].addPoint([x, currentCelsius], true, true, true);
			} else {
				chartT.series[2].addPoint([x, currentCelsius], true, false, true);
			}
};
</script>

<script>
function selectProbeTType(event) {
    //var selected_text = event.options[event.selectedIndex].innerHTML;
	//console.log("text "); console.log(selected_text);
    var selected_value = event.value;
	//console.log("value "); console.log(selected_value);
	doSend('1ST'+selected_value);
}

function selectProbeTAmount(event) {
    var selected_value = event.value;
	doSend('1SN'+selected_value);
}

function selectProbeHType(event) {
    var selected_value = event.value;
	
	//doSend('1ST'+selected_value);
}

function selectProbeHAmount(event) {
    var selected_value = event.value;
	doSend('1HN'+selected_value);
}

function selectUpdateGraphTime(event) {
    var selected_value = event.value;
	doSend('1Z1'+selected_value);
}

function updateButton(fixedVariable) { 
	if (document.getElementById(fixedVariable).checked == true){			
		if (fixedVariable == '1I1'){
		clearInterval(refreshIntervalId1); 
		document.getElementById("1I1").checked = false;
		//doSend('1I1'+0);
		}
		else if (fixedVariable == '1U1'){
//		document.getElementById("1U1").checked = true;
		doSend('1U1');
		}		
		else {
		doSend(fixedVariable+1);
		}
		}
	else if (document.getElementById(fixedVariable).checked == false){	
		if (fixedVariable == '1I1'){
		clearInterval(refreshIntervalId1);
		document.getElementById("1I1").checked = false;
		//doSend('1I1'+0);
		}					
		else {
		doSend(fixedVariable+0);
	}  
	}
	}

function updateText(fixedVariable) {
	if (fixedVariable == 'cv1'){
	 doSend('1V1'+cv1.value);
	}
	else if (fixedVariable == 'cv2'){
	 doSend('1V2'+cv2.value);
	}
	else if (fixedVariable == 'cv3'){
	doSend('1V3'+cv3.value);
	}
	else if (fixedVariable == 'cv4'){
	doSend('1V4'+cv4.value);
	}
	else if (fixedVariable == 'cv5'){
	doSend('1V5'+cv5.value);
	}
	else if (fixedVariable == 'pv1'){
	doSend('1W1'+pv1.value);
	}
	else if (fixedVariable == 'pv2'){
	doSend('1W2'+pv2.value);
	}
	else if (fixedVariable == 'pv3'){
	doSend('1W3'+pv3.value);
	}	
}

function updateTemp(fixedVariable) {
	if (fixedVariable == '1A1'){
	 doSend('1A1'+A1.value);
	}
	else if (fixedVariable == '1A2'){
	 doSend('1A2'+A2.value);
	}
	
	else if (fixedVariable == '1C1'){
	 doSend('1C1'+C1.value);
	}
	else if (fixedVariable == '1C2'){
	 doSend('1C2'+C2.value);
	}
	
	else if (fixedVariable == '1K1'){
	 doSend('1K1'+K1.value);
	 offsetFromTargetTempMax = targetValue;
	}
	else if (fixedVariable == '1K2'){
	 doSend('1K2'+K2.value);
	 offsetFromTargetTempMin = targetValue;
	}

	else if (fixedVariable == 'I'){
	 doSend('I'+ssid.value);
	}
	else if (fixedVariable == 'P'){
	 doSend('P'+pass.value);
	}
	else if (fixedVariable == 'L'){
	
		var timeON = document.getElementById("lightsON").value;
		var timeOFF = document.getElementById("lightsOFF").value;
		hourStart = timeON.slice(0, 2);	
		minuteStart = timeON.slice(3, 5);
		hourStop = timeOFF.slice(0, 2);
		minuteStop = timeOFF.slice(3, 5);
		//console.log("L"+hourStart+minuteStart+hourStop+minuteStop);
		doSend("L"+hourStart+minuteStart+hourStop+minuteStop);
	}			
}

function updateSlider(fixedVariable, slideAmount){
		document.getElementById(fixedVariable).innerHTML = slideAmount;
		doSend(fixedVariable+slideAmount);
	}

function playSound1(repeats){
		numberofRingsAlarm1=repeats;
		var sound = new Audio('/alarm.mp3');
		sound.play();
			if (numberofRingsAlarm1 > 1){
			refreshIntervalId1 = setInterval(function(){
			var sound = new Audio('/alarm.mp3');
			sound.play(); 
			timer1Counter = timer1Counter + 1;
			blockSound1(numberofRingsAlarm1, timer1Counter);
			}, 2900);
			}
	}			
	
</script>
<script>
	function blockSound1(numberofRings, timerCounter){
		if (timerCounter >= numberofRings){
		clearInterval(refreshIntervalId1);
		document.getElementById("1I1").checked = false;
		//console.log("switches alarm sign off");
		}
	}
</script>

<script>
/*
function setTab() {
  var x = document.getElementById("SetTab");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
*/

function setTab(fixedVariable) {
  var x = document.getElementById(fixedVariable);
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>

<script>
function updateTime(){
        var momentNow = moment();
        $('#date-part').html(momentNow.format('YYYY MMMM DD') + ' '
                            + momentNow.format('dddd')
                             .substring(0,3).toUpperCase());
        $('#time-part').html(momentNow.format('HH:mm:ss'));
		
		var currentD = new Date();
		var startLights = new Date();

		startLights.setHours(hourStart,minuteStart); // 5.30 pm
		//console.log(startLights);
		
		var endLights = new Date();
		endLights.setHours(hourStop,minuteStop); // 6.30 pm
		//console.log(endLights);

		if(currentD >= startLights && currentD < endLights ){
		//console.log("lights ON");
			if (document.getElementById("1L2").checked == false){
				doSend('1L2'+1);
			}
		}
		else{
		//	console.log("lights off");
			if (document.getElementById("1L2").checked == true)
			doSend('1L2'+0);
			}	
		}
</script>

<script>
function openTab(fixedVariable, evt, cityName) {
if (fixedVariable == '1Z1'){
document.getElementById('1Z2').checked = false;
document.getElementById('1Z3').checked = false;
document.getElementById('1Z4').checked = false;
document.getElementById('1Z5').checked = false;
}
else if (fixedVariable == '1Z2'){
document.getElementById('1Z1').checked = false;
document.getElementById('1Z3').checked = false;
document.getElementById('1Z4').checked = false;
document.getElementById('1Z5').checked = false;
}
else if (fixedVariable == '1Z3'){
document.getElementById('1Z2').checked = false;
document.getElementById('1Z1').checked = false;
document.getElementById('1Z4').checked = false;
document.getElementById('1Z5').checked = false;
}
else if (fixedVariable == '1Z4'){
document.getElementById('1Z2').checked = false;
document.getElementById('1Z3').checked = false;
document.getElementById('1Z1').checked = false;
document.getElementById('1Z5').checked = false;
}
else if (fixedVariable == '1Z5'){
document.getElementById('1Z2').checked = false;
document.getElementById('1Z3').checked = false;
document.getElementById('1Z1').checked = false;
document.getElementById('1Z4').checked = false;
}

if (document.getElementById(fixedVariable).checked == true){
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(cityName).style.display = "block";
  evt.currentTarget.className += " active";
  }
  else {
  document.getElementById(fixedVariable).checked = false;
  document.getElementById(cityName).style.display = "none";
  }
}

function toggleoff(parentElement){

parentElement.style.display='none';
document.getElementById('1Z1').checked = false;
document.getElementById('1Z2').checked = false;
document.getElementById('1Z3').checked = false;
document.getElementById('1Z4').checked = false;
document.getElementById('1Z5').checked = false;

}

// Get the element with id="defaultOpen" and click on it
//document.getElementById("defaultOpen").click();
</script>
  
</body>